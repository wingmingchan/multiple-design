#*
《code》
《copyright》
Authors: Wing Ming Chan
Copyright (c) 2017 Wing Ming Chan <chanw@upstate.edu>
MIT Licensed
Modification history:
5/19/2017 Added documentation.
5/18/2017 Fixed the code to use display names of folders.
《/copyright》
《documentation id=“top”》
《h2》Introduction《/h2》
《p》This is the component used to generate a folder nav (the left/right menu).
Note that following Upstate's business logic, display names of folders,
not display names of index pages, are used in the nav. The same logic applies
to breadcrumbs.《/p》
《/documentation》
*#
$globalStringBuffer.setLength( 0 ) ## clear the string buffer
    
## use currentPage to avoid index cache problem
#set( $folder_path      = $currentPage.ParentFolderIdentifier.Path.PathAsString )

#if( !$folder_path.startsWith( '/' ) )
    #set( $folder_path = "/" + $folder_path )
#end

#set( $cur_folder_xpath = "//system-folder[path='$folder_path']" )
#set( $cur_folder       = $_XPathTool.selectSingleNode( $contentRoot, $cur_folder_xpath ) )
#set( $cur_folder_display_name = $_EscapeTool.xml( $cur_folder.getChild( 'display-name' ).Value ) )

## root pages, etc.
#if( $_PropertyTool.isNull( $cur_folder ) )
    #set( $cur_folder = $contentRoot )
    ## work out the site title for the root index page
    #chanwReviveGlobalVariable( "SiteTitleString" $design_namespace )
    #set( $cur_folder_display_name = $chanwReviveGlobalVariable )
#end

#set( $cur_folder_children = $cur_folder.getChildren() )
    
#if( $cur_folder_children.size() > 0 )
    #set( $void = $globalStringBuffer.append( "<div id='left-menu-div'><div id='left-column'><nav id='left-menu'><ul>" ) )
    	
    #foreach( $child in $cur_folder_children )            
        #set( $child_link = $child.getChild( 'link' ).Value )
        #set( $child_display_name = $_EscapeTool.xml( $child.getChild( 'display-name' ).Value ) )
        #set( $is_current_page    = ( $child.getAttribute( 'current' ).Value == 'true' ) )
            
        #if( $child.name == 'system-page' )
            #if( $child.getChild( 'name' ).Value == 'index' )
                #set( $void = $globalStringBuffer.append( "<li id='menu-label'><a href='${child_link}'>$cur_folder_display_name</a></li>" ) )
            #elseif( $child.getAttribute( 'current' ).Value == 'true' )
                #set( $void = $globalStringBuffer.append( "<li class='lcurrent'><a href='${child_link}'>$child_display_name</a></li>" ) )
            #else
                #set( $void = $globalStringBuffer.append( "<li><a href='${child_link}'>$child_display_name</a></li>" ) )
            #end
        #elseif( $child.name == 'system-folder' )
            #set( $void = $globalStringBuffer.append( "<li><a href='${child_link}/index'>$child_display_name</a></li>" ) )
        #elseif( $child.name == 'system-symlink' )
            #set( $void = $globalStringBuffer.append( "<li><a href='${child_link}'>$child_display_name</a></li>" ) )
        #end
    #end
        
    #set( $void = $globalStringBuffer.append( "</ul></nav></div></div>" ) )
#end
$globalJDOMText.normalizeString( $globalStringBuffer.toString() )
#*
《/code》
*#