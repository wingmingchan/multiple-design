#*doc
《documentationautoflow》
《step id=“pageElementMacrosInitialize”》
    《title》
Set up the 《code》$pageElementMap《/code》 map
and process preMain, main, and postMain.
    《/title》
    《content》
《p》This macro is invoked when an html tree is processed. 
Besides initializing 《code》$pageElementMap《/code》, page 
elements can be generated by invoking relevant macros.
《/p》
《p》The 《code》$pageElementMap《/code》 is a map of strings 
for the various page elements of this design. These individual 
elements will be later merged to form a single HTML page. 
Examples of page elements are header, middleElement, footer, etc. 
These elements can also be called individually to produce 
partial pages which can normally be found in a site's "_extra" folder.《/p》
    《/content》
    《stepcode》
doc*###
#macro( initialize )
    #set( $pageElementMap = {} )
    #chanwInvokeMacro( "${design_namespace}Initialize" )
##
    #macro( rwd4Initialize )
        #setPageElement( "preMain" )
        #setPageElement( "middleContent" )
        #setPageElement( "postMain" )
    #end
#end
##
#*doc
    《/stepcode》
《/step》
《step id=“pageElementMacrosAddBaseAssets”》
    《title》Add base assets for rwd4《/title》
    《content》
rwd4 requires certain CSS and JS files regardless 
of the site being rendered.
    《/content》
    《stepcode》
doc*###
#macro( addBaseAssets )
    #drulykgInvokeMacro( "${design_namespace}AddBaseAssets" )
##
    #macro( rwd4AddBaseAssets )
        ## Set the base assets needed by RWD4
        #drulykgHtmlAssetAdd( 'site://Upstate-Globals/assets/plug-ins/bootstrap/3.3.6/css/bootstrap.css' { 'assetPosition' : 0 } )
        #drulykgHtmlAssetAdd( 'site://Upstate-Globals/assets/css/global-rwd4-v13.css' { 'assetPosition' : 0 } )
        #drulykgHtmlAssetAdd( 'site://Upstate-Globals/assets/print-rwd4.css' { 'assetPosition' : 0, 'attrs' : { 'media' : 'print' } } )
        #drulykgHtmlAssetAdd( 'site://Upstate-Globals/assets/plug-ins/jquery-ui/1.11.4/base/jquery-ui.css' { 'assetPosition' : 0 } )
        #drulykgHtmlAssetAdd( 'site://Upstate-Globals/assets/css/vlightbox1.css' { 'assetPosition' : 0 } )
        #drulykgHtmlAssetAdd( 'site://Upstate-Globals/assets/css/visuallightbox.css' { 'assetPosition' : 0, 'attrs' : { 'media' : 'screen' } } )
        #drulykgHtmlAssetAdd( 'site://Upstate-Globals/assets/css/flexslider-v3.css' { 'assetPosition' : 0 } )
        #drulykgHtmlAssetAdd( 'site://Upstate-Globals/assets/plug-ins/suny-upstate-mega-menu/1.2.4/suny-upstate-mega-menu.css' { 'assetPosition' : 0 } )
        #drulykgHtmlAssetAdd( 'site://Upstate-Globals/assets/plug-ins/smartmenus/1.1.0/css/sm-core-css-suny-upstate-custom.css' { 'assetPosition' : 0 } )
        #drulykgHtmlAssetAdd( 'site://Upstate-Globals/assets/plug-ins/smartmenus/1.1.0/css/sm-blue/sm-blue-suny-upstate-custom.css' { 'assetPosition' : 0 } )
        #drulykgHtmlAssetAdd( 'site://Upstate-Globals/assets/css/upstate-mini-menu-1.0.0.css' { 'assetPosition' : 0 } )
##
        #drulykgHtmlAssetAdd( 'site://Upstate-Globals/assets/plug-ins/jquery/1.12.4/jquery.js' { 'assetPosition' : 0 } )
        #drulykgHtmlAssetAdd( 'site://Upstate-Globals/assets/plug-ins/fontawesome/5.0.8/fontawesome-all.min.js' { 'assetPosition' : 0 } )
        #drulykgHtmlAssetAdd( 'site://Upstate-Globals/assets/plug-ins/fontawesome/5.0.8/fa-v4-shims.min.js' { 'assetPosition' : 0 } )
        #drulykgHtmlAssetAdd( 'site://Upstate-Globals/assets/js/rwd-v3.js' { 'assetPosition' : 0 } )
        #drulykgHtmlAssetAdd( 'site://Upstate-Globals/assets/plug-ins/jquery-ui/1.11.4/base/jquery-ui.js' { 'assetPosition' : 0 } )
        #drulykgHtmlAssetAdd( 'site://Upstate-Globals/assets/js/jquery.tablesorter.js' { 'assetPosition' : 0 } )
        #drulykgHtmlAssetAdd( 'site://Upstate-Globals/assets/plug-ins/bootstrap/3.3.6/js/bootstrap.js' { 'assetPosition' : 0 } )
        #drulykgHtmlAssetAdd( 'site://Upstate-Globals/assets/js/responsiveslides.min.js' { 'assetPosition' : 0 } )
        #drulykgHtmlAssetAdd( 'site://Upstate-Globals/assets/js/jquery-migrate-1.3.0.js' { 'assetPosition' : 0 } )
        #drulykgHtmlAssetAdd( 'site://Upstate-Globals/assets/js/accordion_v5.js' { 'assetPosition' : 0 } )
        #drulykgHtmlAssetAdd( 'site://Upstate-Globals/assets/js/jquery.visuallightbox-5.1.23j.js' { 'assetPosition' : 0 } )
        #drulykgHtmlAssetAdd( 'site://Upstate-Globals/assets/js/jquery.flexslider.js' { 'assetPosition' : 0 } )
        #drulykgHtmlAssetAdd( 'site://Upstate-Globals/assets/plug-ins/suny-upstate-mega-menu/1.2.4/suny-upstate-mega-menu.js' { 'assetPosition' : 0 } )
        #drulykgHtmlAssetAdd( 'site://Upstate-Globals/assets/plug-ins/smartmenus/1.1.0/js/jquery.smartmenus.js' { 'assetPosition' : 0 } )
        #drulykgHtmlAssetAdd( 'site://Upstate-Globals/assets/plug-ins/jquery-scroll-to/2.1.1/jquery.scrollto.js' { 'assetPosition' : 0 } )
        #drulykgHtmlAssetAdd( 'site://Upstate-Globals/assets/plug-ins/simpler-sidebar/2.2.4/simpler-sidebar.min.js' { 'assetPosition' : 0 } )
        #drulykgHtmlAssetAdd( 'site://Upstate-Globals/assets/js/upstate-sidebar-v2.js' { 'assetPosition' : 0 } )
        #drulykgHtmlAssetAdd( 'site://Upstate-Globals/assets/js/activate-upstate-classic-mega-mini-menus-1.0.2.js' { 'assetPosition' : 0 } )
        #drulykgHtmlAssetAdd( 'site://Upstate-Globals/assets/js/defer-jquery-execute.js' { 'assetPosition' : 0 } )
##
        ## These will be encased inside of <!--[if lt IE 9]><![endif]-->
        #drulykgHtmlAssetAdd( 'site://Upstate-Globals/assets/plug-ins/html5shiv/3.7.3/html5shiv.js' { 'assetPosition' : 1 } )
        #drulykgHtmlAssetAdd( 'site://Upstate-Globals/assets/plug-ins/respond-js/1.4.2/respond.js' { 'assetPosition' : 1 } )
        #drulykgHtmlAssetAdd( 'site://Upstate-Globals/assets/plug-ins/ie8-js/0.7.1/ie8.js' { 'assetPosition' : 1 } )
    #end
#end
##
#*doc
    《/stepcode》
《/step》
《step id=“pageElementMacrosGenerateBottomContent”》
    《title》Generate bottom content《/title》
    《content》
Generate contents for the right column/bottom row 
by processing all block choosers in the bottom group
    《/content》
    《stepcode》
doc*###
#macro( generateBottomContent )
    ## process block choosers
    #upstateProcessBlockChooser( $currentPage "bottom-group/mul-bottom-group-chooser" )
#end
##
#*doc
    《/stepcode》
《/step》
《step id=“pageElementMacrosGenerateBottomElement”》
    《title》Generate bottom element《/title》
    《content》
Generate the element wrapping the bottom contents
    《/content》
    《stepcode》
doc*###
#macro( generateBottomElement )
    #resolvePageTreeName
    #chanwInvokeMacro( "${design_namespace}GenerateBottomElement" )
##
    #macro( rwd4GenerateBottomElement )
    <${siteConfigMap[ 'bottomElement' ].trim()} ${bottomIdAttribute} class="${bottomCssClass}">
    #outputPageElement( "bottomContent" )
    </${siteConfigMap[ 'bottomElement' ].trim()}>
    #end
#end
##
#*doc
    《/stepcode》
《/step》
《step id=“pageElementMacrosGenerateBreadcrumbs”》
    《title》Generate breadcrumbs《/title》
    《content》
    《/content》
    《stepcode》
doc*###
#macro( generateBreadcrumbs )
    #chanwInvokeMacro( "${design_namespace}GenerateBreadcrumbs" )
##
    #macro( rwd4GenerateBreadcrumbs )
        ## Make sure this is not a page which omits breadcrumbs
        #if( !$siteConfigMap[ 'pagesWithoutBreadcrumbs' ].contains( $currentPagePath ) )
            ## Set up some internal vars
            #set( $createPageBreadcrumbsVars = {
                'currentFolderPath': '',
                'out': '',
                'pathParts': $currentPage.path.split( '/' )
            } )
            ## Start up the HTML for breadcrumbs
            #drulykgAppendVar( '$createPageBreadcrumbsVars[ "out" ]' '<div id="breadcrumb-div" class="hidden-xs hidden-sm">' )
            #drulykgAppendVar( '$createPageBreadcrumbsVars[ "out" ]' '<div class="container" id="breadcrumb-site-search-div">' )
            #drulykgAppendVar( '$createPageBreadcrumbsVars[ "out" ]' '<div class="row">' )
            #drulykgAppendVar( '$createPageBreadcrumbsVars[ "out" ]' '<nav class="col-sm-9" id="breadcrumb">' )
##
            ## Loop the path parts and build links starting from the
            ## root of the site all the way until this page's parent folder
            #foreach( $item in $createPageBreadcrumbsVars[ 'pathParts' ] )
                ## Upon first iteration, force the root breadcrumb
                #if( $foreach.index == 0 )
                    ## If we have more items to follow or if this page is not
                    ## $siteConfigMap[ 'siteRootPageNameOfFolder' ] then encase
                    ## the breadcrumb in an <a> tag
                    #if(
                        $foreach.hasNext ||
                        $currentPage.Name != $siteConfigMap[ 'siteRootPageNameOfFolder' ]
                    )
                        #drulykgHtmlTag( 'a' {
                            'appendTo': '$createPageBreadcrumbsVars[ "out" ]',
                            'attrs': {
                                'href': $_EscapeTool.xml( "site://${currentPageSiteName}/${siteConfigMap[ 'siteRootPageNameOfFolder' ]}" )
                            },
                            'closeTag': true,
                            'content': $siteConfigMap[ 'breadcrumbsHomeString' ]
                        } )
                    #else
                        ## Just display the breadcrumbsHomeString
                        #drulykgAppendVar( '$createPageBreadcrumbsVars[ "out" ]' $siteConfigMap[ 'breadcrumbsHomeString' ] )
                    #end
                #end
##
                ## Since the current page is an item in the pathParts list
                ## we need to make sure to not process the page item
                ## because we want to stop at the current page's
                ## parent folder
                #if( $foreach.hasNext )
##
                    ## Add the breadcrumb separator
                    #drulykgAppendVar( '$createPageBreadcrumbsVars[ "out" ]' " ${siteConfigMap[ 'breadcrumbsSeparatorString' ]} " )
##
                    ## Keep track of the path to the current folder so that
                    ## we can use $_.locateFolder with ease
                    #drulykgAppendVar( '$createPageBreadcrumbsVars[ "currentFolderPath" ]' $item )
##
                    ## Build the folder breadcrumb
                    #if(
                        $currentPage.Name == $siteConfigMap[ 'siteRootPageNameOfFolder' ] &&
                        $foreach.count == $_MathTool.sub( $createPageBreadcrumbsVars[ 'pathParts' ].size(), 1)
                    )
                        ## Do not use an <a> tag if we are on the final folder and
                        ## currently rendering the $siteConfigMap[ 'siteRootPageNameOfFolder' ] page
                        #drulykgAppendVar( '$createPageBreadcrumbsVars[ "out" ]' $_EscapeTool.xml( $_.locateFolder( $createPageBreadcrumbsVars[ 'currentFolderPath' ], $currentPageSiteName ).Metadata.DisplayName ) )
                    #else
                        ## Surround the breadcrumb in an <a> tag
                        #drulykgHtmlTag( 'a' {
                            'appendTo': '$createPageBreadcrumbsVars[ "out" ]',
                            'attrs': {
                                'href': $_EscapeTool.xml( "site://${currentPageSiteName}/${createPageBreadcrumbsVars[ 'currentFolderPath' ]}/${siteConfigMap[ 'siteRootPageNameOfFolder' ]}" )
                            },
                            'closeTag': true,
                            'content': $_EscapeTool.xml( $_.locateFolder( $createPageBreadcrumbsVars[ 'currentFolderPath' ], $currentPageSiteName ).Metadata.DisplayName )
                        } )
                    #end
    ##
                    ## Since we are not done, add a slash to the currentFolderPath
                    ## so that the next iteration can simply add its $item
                    #drulykgAppendVar( '$createPageBreadcrumbsVars[ "currentFolderPath" ]' "/" )
                #end
            #end
##
            ## Close the breadcrumb container and nav
            #drulykgAppendVar( '$createPageBreadcrumbsVars[ "out" ]' '</nav>' )
            #drulykgAppendVar( '$createPageBreadcrumbsVars[ "out" ]' '</div>' )## row
            #drulykgAppendVar( '$createPageBreadcrumbsVars[ "out" ]' '</div>' )## container
            #drulykgAppendVar( '$createPageBreadcrumbsVars[ "out" ]' '</div>' )## breadcrumb-div
##
            ## Output the breadcrumb!
            $createPageBreadcrumbsVars[ "out" ]
        #end
    #end
#end
##
#*doc
    《/stepcode》
《/step》
《step id=“generateBrightEdgeCloseConnection”》
    《title》Generate the PHP code to close the BrightEdge connection《/title》
    《content》《/content》
    《stepcode》
doc*###
#macro( generateBrightEdgeCloseConnection )
    #if( $currentPageSiteName == 'cancer' )
        $S_PHP_PASSTHROUGH
        if( BEIXF_allowed() )
        {
            print ${_EscapeTool.d}be_ixf->close();
        }
        $E_PHP_PASSTHROUGH
    #end
#end
##
#*doc
    《/stepcode》
《/step》
《step id=“generateBrightEdgeSEOTags”》
    《title》Generate the PHP code to invoke BrightEdge's SEO stuff《/title》
    《content》
    BrightEdge needs this?
    《/content》
    《stepcode》
doc*###
#macro( generateBrightEdgeSEOTags )
    #if( $currentPageSiteName == 'cancer' )
        $S_PHP_PASSTHROUGH
        if( BEIXF_allowed() )
        {
            print ${_EscapeTool.d}be_ixf->getBodyOpen();
        }
        $E_PHP_PASSTHROUGH
    #end
#end
##
#*doc
    《/stepcode》
《/step》
《step id=“pageElementMacrosGenerateEditButtonPHP”》
    《title》Generate an edit button《/title》
    《content》
    Provide an edit button which visitors can click and be taken directly to the page within Cascade.
    《/content》
    《stepcode》
doc*###
#macro( generateEditButtonPHP )
    #chanwInvokeMacro( "${design_namespace}GenerateEditButtonPHP" )
##
    #macro( rwd4GenerateEditButtonPHP )
        createEditButton( '${currentPage.identifier.id}' );
    #end
#end
##
#*doc
    《/stepcode》
《/step》
《step id=“pageElementMacrosGenerateFolderNav”》
    《title》Generate folder nav《/title》
    《content》
    Generate folder nav, normally appearing in the left column/top row
    《/content》
    《stepcode》
doc*###
#macro( generateFolderNav )
##
    #drulykgHtmlTag( $nulllll {
        'persistentSettings' : {
            'siteRootPageNameOfFolder' : $_EscapeTool.xml( $siteConfigMap[ 'siteRootPageNameOfFolder' ] )
        }
    } )
##
    #chanwInvokeMacro( "${design_namespace}GenerateFolderNav" )
##
    #macro( rwd4GenerateFolderNav )
#import( 'site://_brisk/app/components/siteNavHtmlShell' )
<nav id="left-menu" class="hidden-xs hidden-sm">
    #siteNavHtmlShell( $currentPage.ParentFolder {
        'excludeMetadataName': 'exclude-from-left-folder-nav',
        'excludeMetadataValue': 'yes',
        'maxFolderDepth': 1,
        'rootChildActiveTagAttrs': {
            'class': 'lcurrent'
        },
        'rootHomePageChildAttrs': {
            'id': 'menu-label'
        },
        'rootHomePageDisplayName': "#if($currentPage.ParentFolder.Name == '/')${siteConfigMap[ 'siteTitleString' ]}#{else}${_EscapeTool.xml($currentPage.ParentFolder.Metadata.DisplayName)}#{end}",
        'showRootHomePage': true,
        'skipRootChildActiveTagAttrsForHomePage': true
    } )
</nav>    
    #end
#end
##
#*doc
    《/stepcode》
《/step》
《step id=“pageElementMacrosGenerateFooter”》
    《title》Generate the footer《/title》
    《content》
    《/content》
    《stepcode》
doc*###
#macro( generateFooter )
    #if( $siteConfigMap[ 'footer' ].Class.Name )
        #chanwImportScript( "${BRISK_APP[ 'SITE_DESIGNS_PATH_NTS' ]}/${design_namespace}" $BRISK[ 'APP_SITE_NAME' ] $siteConfigMap[ 'footer' ] )
    #else
         #chanwInvokeMacro( "${design_namespace}GenerateFooterContent" )
         #chanwInvokeMacro( "${design_namespace}GenerateLastModified" )
    #end
#end
##
#macro( generateFooterContent )
    #chanwInvokeMacro( "${design_namespace}GenerateFooterContent" )
##
    #macro( rwd4GenerateFooterContent )
<div class="container" id="footer-content">
##
$S_SYSTEM_VIEW_INTERNAL
<div class="nav-accordion clearfix">
<h2 class="footer-nav-more text-gray bold col-sm-12">More Upstate Information</h2>
<div class="col-sm-3 marginbottom9">
<div class="footer-links-header">Upstate Medical University</div>
<a class="footer" href="http://www.upstate.edu/about/leadership.php">Upstate Leadership</a><br /> <a class="footer" href="http://www.upstate.edu/about/mission.php">Mission, Vision, Values</a><br /> <a class="footer" href="http://www.upstate.edu/com/">College of Medicine</a><br /> <a class="footer" href="http://www.upstate.edu/con/">College of Nursing</a><br /> <a class="footer" href="http://www.upstate.edu/chp/">College of Health Professions</a><br /> <a class="footer" href="http://www.upstate.edu/grad/">College of Graduate Studies</a><br /> <a class="footer" href="http://library.upstate.edu/">Health Sciences Library</a><br /> <a class="footer" href="http://www.upstate.edu/education/friends.php">Alumni &amp; Friends</a><br /> <a class="footer" href="http://www.upstate.edu/about/visitors/index.php">Visitor's Guide</a></div>
<div class="col-sm-3 marginbottom9">
<div class="footer-links-header">Patient Care</div>
<a class="footer" href="http://www.upstate.edu/hospital/">Upstate University Hospital</a><br /> <a class="footer" href="http://www.upstate.edu/gch/">Upstate Golisano Children's Hospital</a><br /> <a class="footer" href="http://www.upstate.edu/community/">Upstate University Hospital at Community</a><br /> <a class="footer" href="http://www.upstate.edu/cancer/">Upstate Cancer Center</a><br /> <a class="footer" href="http://www.upstate.edu/whn/">Women's Health</a><br /> <a class="footer" href="http://www.upstate.edu/hospital/providers/">Find a Doctor</a><br /> <a class="footer" href="http://www.upstate.edu/hospital/patients/mychart.php">MyChart</a></div>
<div class="col-sm-3 marginbottom9">
<div class="footer-links-header">More Links</div>
<a class="footer" href="http://www.upstate.edu/news/">Upstate News</a><br /> <a class="footer" href="http://www.upstate.edu/about/">About Upstate</a><br /> <a class="footer" href="http://www.upstate.edu/directions/">Maps &amp; Directions</a><br /> <a class="footer" href="http://www.upstate.edu/webcal/main.php">Upstate Calendars</a><br /> <a class="footer" href="http://www.upstate.edu/search/index.php?tab=people">Search Upstate</a><br /> <a class="footer" href="http://www.upstate.edu/hr/jobs/">Jobs</a><br /> <a class="footer" href="http://www.upstate.edu/volunteers/">Volunteer</a><br /> <a class="footer" href="http://www.foundationforupstate.org/">Give to Upstate</a><br /> <a class="footer" href="http://www.upstate.edu/about/contact.php">Contact</a><br /> <a class="footer" href="http://libproxy.upstate.edu/login?url=http://www.upstate.edu/ipage/intra/">iPage</a></div>
<div class="col-sm-3 marginbottom9">
<div class="footer-links-header">Social Media</div>
<div class="padbottom9"><a class="footer" href="http://www.upstate.edu/publicaffairs/socialmedia.php">Upstate Social Media</a></div>
<div class="clearfix">
<div class="leftobject width65px"><a href="https://www.facebook.com/UpstateMedicalUniversity"><img alt="Upstate on Facebook" class="img-responsive" src="http://www.upstate.edu/assets/images/facebook-rwd.gif" height="64" width="64" /></a></div>
<div class="leftobject width65px"><a href="https://twitter.com/UpstateNews"><img alt="Upstate on Twitter" class="img-responsive" src="http://www.upstate.edu/assets/images/twitter-rwd.gif" height="64" width="64" /></a></div>
</div>
<div class="padbottom9 padtop9 clearfix clr">
<div class="leftobject width65px"><a href="https://www.youtube.com/user/UpstateMedicalUniv"><img alt="Upstate on Youtube" class="img-responsive" src="http://www.upstate.edu/assets/images/youtube-rwd.gif" height="64" width="64" /></a></div>
<div class="leftobject width65px"><a href="https://whatsupatupstate.wordpress.com/"><img alt="What's up at Upstate" class="img-responsive" src="http://www.upstate.edu/assets/images/wordpress-rwd.gif" height="64" width="64" /></a></div>
</div>
</div>
<div class="clr"></div>
<hr class="width100 thin text_lightgray bg_lightgray" />
</div>
$E_SYSTEM_VIEW_INTERNAL$S_SYSTEM_VIEW_EXTERNAL
$S_PHP_PASSTHROUGH
createDefaultGlobalFooter( ${_EscapeTool.d}localflag, ${_EscapeTool.d}intraflag );
$E_PHP_PASSTHROUGH
$E_SYSTEM_VIEW_EXTERNAL
</div>    
    #end
#end
##
#macro( generateLastModified )
    #chanwInvokeMacro( "${design_namespace}GenerateLastModified" )
##
    #macro( rwd4GenerateLastModified )
<div id="last-modified">
<div id="copyright">All contents copyright © 1988-${S_SYSTEM_VIEW_INTERNAL}${chanwCurrentYearInt}$E_SYSTEM_VIEW_INTERNAL
$S_SYSTEM_VIEW_EXTERNAL$S_PHP_PASSTHROUGH ${_EscapeTool.d}date = getdate(); ${_EscapeTool.d}thisyear = ${_EscapeTool.d}date['year']; echo "${_EscapeTool.d}thisyear, "; $E_PHP_PASSTHROUGH$E_SYSTEM_VIEW_EXTERNAL
<a class="footer" href="http://www.upstate.edu/">SUNY Upstate Medical University</a>, Syracuse, NY<br />
$S_SYSTEM_VIEW_EXTERNAL$S_PHP_PASSTHROUGH createPolicyLinks(); $E_PHP_PASSTHROUGH${E_SYSTEM_VIEW_EXTERNAL}</div>
$S_SYSTEM_VIEW_INTERNAL
<div id="privacy-policy">
	<a href="http://www.upstate.edu/privacy.php">Privacy Policy</a> |
	<a href="http://www.upstate.edu/hospital/patients/admitting/privacypractices.php">Notice of Privacy Practices</a> |
	<a href="http://www.upstate.edu/emergencyinfo/">Emergency Information</a> |
	<a href="http://www.upstate.edu/foil/">Freedom of Information</a> |
	<a href="https://get.adobe.com/reader/">Acrobat Reader</a> |
	<a href="http://www.upstate.edu/healthcare/nondiscrimination.php">Non-discrimination Statement</a>
</div>
$E_SYSTEM_VIEW_INTERNAL
#set( $contactName  = $siteConfigMap[ 'siteContactPerson' ] )
##
#if( $siteConfigMap[ 'siteContactEmail' ] != "" )
    #set( $contactEmail = $siteConfigMap[ 'siteContactEmail' ] + '@upstate.edu' )
#end
##
#if( $contactName.trim() != "" && $contactEmail )
<div id="contact">Last Modified:
#set( $lastModifiedDayObj = $currentPage.LastModified )$_DateTool.format( "MMMMM dd, yyyy", $lastModifiedDayObj ).
$S_SYSTEM_VIEW_EXTERNAL$S_PHP_PASSTHROUGH
echo " Contact <a href='http://www.upstate.edu/email_form.php?name=" . urlencode('${contactName}') . 
"&to=" . base64_encode('${contactEmail}') . 
"' class='footer'>$contactName" . "</a> with questions about the content of this page. ";
#generateEditButtonPHP
if($intraflag) { echo "<br /><br />This Intranet page is to be used for official purposes of SUNY Upstate,
<br />and should not be made accessible to non-SUNY Upstate users."; }
$E_PHP_PASSTHROUGH$E_SYSTEM_VIEW_EXTERNAL
${S_SYSTEM_VIEW_INTERNAL}Contact $contactName with questions about the content of this page.$E_SYSTEM_VIEW_INTERNAL</div>
#end
</div>
    #end
##
#end
##
#*doc
    《/stepcode》
《/step》
《step id=“pageElementMacrosGenerateGoogleTagManager”》
    《title》Generate google tag manager code《/title》
    《content》
    《/content》
    《stepcode》
doc*###
#macro( generateGoogleTagManager )
    #if( $siteConfigMap[ 'google-tag-manager' ].Class.Name )
        #chanwImportScript( $BRISK_APP[ 'COMPONENTS_PATH_NTS' ] $BRISK[ 'APP_SITE_NAME' ] $siteConfigMap[ 'google-tag-manager' ] )
    #else
<!-- Google Tag Manager -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&amp;l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-MJNRN6');</script>
<!-- End Google Tag Manager -->
    #end
#end
##
#*doc
    《/stepcode》
《/step》
《step id=“pageElementMacrosGenerateGoogleTagManagerNoscript”》
    《title》Generate google tag manager noscript code《/title》
    《content》
    《/content》
    《stepcode》
doc*###
#macro( generateGoogleTagManagerNoscript )
    #if( $siteConfigMap[ 'google-tag-manager' ].Class.Name )
        #chanwImportScript( $BRISK_APP[ 'COMPONENTS_PATH_NTS' ] $BRISK[ 'APP_SITE_NAME' ] $siteConfigMap[ 'google-tag-manager-noscript' ] )
    #else
<!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-MJNRN6"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) -->
    #end
#end
##
#*doc
    《/stepcode》
《/step》
《step id=“pageElementMacrosGenerateHeader”》
    《title》Generate header《/title》
    《content》
    《/content》
    《stepcode》
doc*###
#macro( generateHeader )
    #if( $siteConfigMap[ 'header' ].Class.Name )
        #chanwImportScript( "${BRISK_APP[ 'SITE_DESIGNS_PATH_NTS' ]}/${design_namespace}" $BRISK[ 'APP_SITE_NAME' ] $siteConfigMap[ 'header' ] )
    #else
        #chanwInvokeMacro( "${design_namespace}GenerateHeader" )
    #end
##
    #macro( rwd4GenerateHeader )
        <$siteConfigMap[ 'headerElement' ]>
            <div class="header-container">
                <div class="container">
                    <div class="row header-row">
                        #rwd4GenerateLogo
                        #macro( rwd4GenerateLogo )
                        <div class="col-md-3 header-logo-div">
                            #drulykgHtmlTag( 'a' {
                                'attrs': {
                                    'class': 'header-logo-link',
                                    'href': $siteConfigMap[ 'siteLogoClickDestination' ]
                                },
                                'closeTag': false
                            } )
                            #set( $rwd4GenerateLogo_a_close = $drulykgHtmlTagCloseTag )
                                #drulykgHtmlTag( 'img' {
                                    'attrs': {
                                        'alt': $siteConfigMap[ 'siteLogoAltText' ],
                                        'src': $siteConfigMap[ 'siteLogoFile' ]
                                    }
                                } )
                            $rwd4GenerateLogo_a_close
                        </div>
                        #end
                        ##macro( rwd4TreeGenerateLogo )
                            ##rwd4GenerateLogo
                        ##end
                        #rwd4GenerateSiteTitle
                        #macro( rwd4GenerateSiteTitle )
                        #if(
                            $siteConfigMap[ 'renderSiteTitle' ] &&
                            $siteConfigMap[ 'siteTitleString' ].Class.Name &&
                            $siteConfigMap[ 'siteTitleString' ] != "" &&
                            !$siteConfigMap[ 'pagesWithoutSiteTitle' ].contains( $currentPagePath )
                        )
                            #drulykgHtmlTag( 'a' {
                                'attrs': {
                                    'class': [ 'header-site-title-link', 'hidden-xs', 'hidden-sm' ],
                                    'href': $_.locatePage( $siteConfigMap[ 'siteRootPageNameOfFolder' ] , $currentPageSiteName )
                                },
                                'closeTag': true,
                                'content': $siteConfigMap[ 'siteTitleString' ]
                            } )
                        #end
                        #end
                        ##macro( rwd4TreeGenerateSiteTitle )
                            ##rwd4GenerateSiteTitle
                        ##end
                        #rwd4GenerateGlobalNavButton
                        #macro( rwd4GenerateGlobalNavButton )
                        #if( $siteConfigMap[ 'renderGlobalNav' ] )
                            <a href="javascript:;" class="sidebar-toggle-btn">
                                <span class="fas fa-search" aria-hidden="true"></span><span class="hidden-xs sidebar-menu-text">MENU</span><span class="fas fa-bars" aria-hidden="true"></span>
                            </a>
                        #end
                        $S_PHP_PASSTHROUGH
                        if( ${_EscapeTool.d}intraflag )
                        {
                            echo '<div class="header-intranet-container">'.bricks( 'header_intranet_icon' ).' Intranet</div>';
                        }
                        $E_PHP_PASSTHROUGH
                        #end
                        ##macro( rwd4TreeGenerateGlobalNavButton )
                            ##rwd4GenerateGlobalNavButton
                        ##end
                    </div>
                </div>
                #rwd4GenerateGlobalNavSidebar
                #macro( rwd4GenerateGlobalNavSidebar )
                #if( $siteConfigMap[ 'renderGlobalNav' ] )
                    <div class="sidebar">
                        <div class="sidebar-wrapper" role="navigation">
                            <div class="sidebar-header">
                                <a class="sidebar-close-btn" href="javascript:;"><span class="glyphicon glyphicon-remove"></span> Close</a>
##
                                $S_SYSTEM_VIEW_INTERNAL
                                <form class="sidebar-search-form" action="http://www.upstate.edu/intra/search/index.php" method="get" name="search-form">
                                    <label for="search_upstate_textbox" class="sr-only">SEARCH UPSTATE${_EscapeTool.s}S INTRANET</label>
                                    <input class="form-control" type="text" id="search_upstate_textbox" value="SEARCH UPSTATE${_EscapeTool.s}S INTRANET" data-default_value="SEARCH UPSTATE${_EscapeTool.s}S INTRANET" name="q"/>
                                </form>
                                $E_SYSTEM_VIEW_INTERNAL
##
                                $S_PHP_PASSTHROUGH
                                createSearchFormForSideBar( ${_EscapeTool.d}localflag );
                                $E_PHP_PASSTHROUGH
                            </div>
                            <ul class="nav nav-pills nav-stacked sidebar-nav">
##
                                $S_SYSTEM_VIEW_INTERNAL
                                <li><a href="http://www.upstate.edu/search/intra/index.php?tab=people&amp;q=">PEOPLE FINDER</a></li>
                                <li><a href="http://www.upstate.edu/education">ACADEMICS</a></li>
                                <li><a href="http://www.upstate.edu/research">RESEARCH</a></li>
                                <li><a href="http://www.upstate.edu/healthcare/">PATIENT CARE</a></li>
                                <li><a href="http://www.upstate.edu/outreach/">OUTREACH</a></li>
                                <li><a href="http://www.upstate.edu/healthcare/providers/">FIND A DOCTOR</a></li>
                                <li><a href="http://www.upstate.edu/directions">LOCATIONS</a></li>
                                <li><a href="http://www.upstate.edu/webcal/main.php">CALENDAR</a></li>
                                <li><a href="http://library.upstate.edu/">LIBRARY</a></li>
                                <li><a href="http://www.upstate.edu/hr/jobs">JOBS</a></li>
                                <li><a href="http://libproxy.upstate.edu/login?url=http://www.upstate.edu/ipage/intra/">IPAGE</a></li>
                                $E_SYSTEM_VIEW_INTERNAL
##
                                $S_PHP_PASSTHROUGH
                                createHealthcareGlobalMenuForSideBar( ${_EscapeTool.d}localflag, ${_EscapeTool.d}intraflag );
                                $E_PHP_PASSTHROUGH
                            </ul>
                        </div>
                    </div>
                #end
                #end
                ##macro( rwd4TreeGenerateGlobalNavSidebar )
                    ##rwd4GenerateGlobalNavSidebar
                ##end
            </div>
        </$siteConfigMap[ 'headerElement' ]>
    #end
##
    #macro( generateLogo )
        #chanwInvokeMacro( "${design_namespace}GenerateLogo" )
    #end
##
    #macro( generateSiteTitle )
        #chanwInvokeMacro( "${design_namespace}GenerateSiteTitle" )
    #end
##
    #macro( generateGlobalNavButton )
        #chanwInvokeMacro( "${design_namespace}GenerateGlobalNavButton" )
    #end
##
    #macro( generateGlobalNavSidebar )
        #chanwInvokeMacro( "${design_namespace}GenerateGlobalNavSidebar" )
    #end
#end
##
#*doc
    《/stepcode》
《/step》
《step id=“pageElementMacrosGenerateLink”》
    《title》Generate link elements《/title》
    《content》
    《/content》
    《stepcode》
doc*###
#macro( generateLink )
    #if( $siteConfigMap[ 'link' ].Class.Name )
        #chanwImportScript( "${BRISK_APP[ 'SITE_DESIGNS_PATH_NTS' ]}/${design_namespace}" $BRISK[ 'APP_SITE_NAME' ] $siteConfigMap[ 'link' ] )
    #else
        #chanwInvokeMacro( "${design_namespace}GenerateLink" )
    #end
##
    #macro( rwd4GenerateLink )
        ## If we are publishing to rwd4-css-include
        ## then we only need the base RWD4 assets
        #if( $currentPageSiteName == 'Upstate-Globals' && $currentPage.Name == "rwd4-css-include" )
            #drulykgHtmlTag( 'script' {
                'attrs' : {
                    'src' : "site://Upstate-Globals/assets/js/defer-jquery.js",
                    'type' : "text/javascript"
                },
                'closeTag' : true
            } )
            <!-- RWD4 Core CSS -->
            #drulykgHtmlAssetOutput( {
                'assetPositionEquals' : 0,
                'assetType' : 'css'
            } )
            <!-- /RWD4 Core CSS -->
        #else
            ## We are publishing a normal web page
            ## Properly differentiate internal Cascade viewing versus external page include
            ##
            $S_SYSTEM_VIEW_INTERNAL
                #drulykgHtmlTag( 'script' {
                    'attrs' : {
                        'src' : "site://Upstate-Globals/assets/js/defer-jquery.js",
                        'type' : "text/javascript"
                    },
                    'closeTag' : true
                } )
                #drulykgHtmlAssetOutput( {
                    'assetType' : 'css'
                } )
            $E_SYSTEM_VIEW_INTERNAL
            $S_SYSTEM_VIEW_EXTERNAL
                $S_PHP_PASSTHROUGH
                    includeGlobalAssets( array( 'design' => 'rwd4' , 'assetType' => 'css' )  );
                $E_PHP_PASSTHROUGH
                <!-- All other CSS -->
                #drulykgHtmlAssetOutput( {
                    'assetPositionDoesNotEqual' : 0,
                    'assetType' : 'css'
                } )
                <!-- /All other CSS -->
            $E_SYSTEM_VIEW_EXTERNAL
        #end
        ## for inserting code like PHP
        <div id="show-page-level-override"></div>
    #end
#end
##
#*doc
    《/stepcode》
《/step》
《step id=“pageElementMacrosGenerateLinkForExternalInclude”》
    《title》Generate link elements in partial pages《/title》
    《content》
    《/content》
    《stepcode》
doc*###
#macro( generateLinkForExternalInclude )
##
    #chanwInvokeMacro( "${design_namespace}GenerateLinkForExternalInclude" )
##
    #macro( rwd4GenerateLinkForExternalInclude )
##
        ## Load the defer-jquery.js early to accommodate various backwards compatibility
        #drulykgHtmlTag( 'script' {
            'attrs' : {
                'src' : "site://Upstate-Globals/assets/js/defer-jquery.js",
                'type' : "text/javascript"
            },
            'closeTag' : true
        } )
##
        ## Load the CSS from position 0 because this should be the design's core CSS files
        <!-- RWD4 Core CSS -->
        #drulykgHtmlAssetOutput( {
            'assetPositionEquals' : 0,
            'assetType' : 'css'
        } )
        <!-- /RWD4 Core CSS -->
##
        ## For inserting code like PHP
        <div id="show-page-level-override"></div>
    #end
#end
##
#*doc
    《/stepcode》
《/step》
《step id=“pageElementMacrosGenerateMeta”》
    《title》Generate meta elements《/title》
    《content》
    《/content》
    《stepcode》
doc*###
#macro( generateMeta )
    <meta content="text/html;charset=utf-8" http-equiv="Content-Type"/>
    <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
    <meta content="IE=edge" http-equiv="X-UA-Compatible"/>
    #set( $summary = $currentPage.Metadata.Summary )
    #if( $summary.Class )
    <meta name="description" content="${_EscapeTool.xml( $summary )}"/>
    #end
    <meta name="id" content="${currentPage.identifier.id}"/>
    <system-page-meta-keywords/>
#end
##
#*doc
    《/stepcode》
《/step》
《step id=“pageElementGenerateMiddleContent”》
    《title》Generate middleContent《/title》
    《content》
middleContent includes H1, choosers defined for the center column/middle row, 
and the WYSIWYG
    《/content》
    《stepcode》
doc*###
#macro( generateMiddleContent $innermainTreePath_generateMiddleContent )
    ## the innermain is generated here
    #set( $generateMiddleContentInvoked = true )
    #if( $innermainTreePath_generateMiddleContent.Class.Name && $innermainTreePath_generateMiddleContent.trim() != "" )
        #set( $chanwInnermainTreeName = $innermainTreePath_generateMiddleContent.trim() )
    #else
        #set( $chanwInnermainTreeName = "site://_brisk/app/scaffolds/innermain-tree" )
    #end
##
    #import( $chanwInnermainTreeName )
    ## this will invoke the 5 inner macros to generate 5 elements without a root
    #chanwDisplayTreeNodeRecursively( $chanwObjectNodeMap[ 'innermain' ] )
##
    #macro( generatePreH1 )
        #upstateProcessBlockChooser( $currentPage "main-group/mul-pre-h1-chooser" '<div class="row"><div class="col-xs-12">' '</div></div>' )
    #end
##
    #macro( generateH1 $row_generateH1 )
        #if( $row_generateH1.Class.Name && $row_generateH1.Class.Name == $JAVA_LANG_BOOLEAN_CLASS_NAME )
            #set( $chanwWithRow = $row_generateH1 )
        #else
            #set( $chanwWithRow = true )
        #end
##
        #if( !$siteConfigMap[ 'skipPageElement' ][ 'h1' ].contains( $currentPagePath ) && !$currentPage.Name.endsWith( "-profile" ) )
            #if( $chanwWithRow )<div class="row">#end
    <div class="col-xs-12">
            #set( $h1String = $currentPage.getStructuredDataNode( "main-group/h1" ).TextValue )
            #if( $h1String.trim() != "" )
<h1>$_EscapeTool.xml( $h1String.trim() )</h1>
            #else
<h1>An H1 Is Required</h1>
            #end
    </div>## col-xs-12
            #if( $chanwWithRow )</div>#end
        #end
    #end
##
    #macro( generatePostH1 )
        #set( $generatePostH1Invoked = true )
        ## post-h1 choosers
        ## User has the option of floating these to the right of the WYSIWYG
        #if( $currentPage.getStructuredDataNode( "main-group/float-pre-content-blocks-around-wysiwyg-content" ).TextValues.size() == 0 )
            #upstateProcessBlockChooser( $currentPage "main-group/mul-post-h1-chooser" '<div class="row"><div class="col-xs-12">' '</div></div>' )
        #end
    ##
        #if( $generateMiddleContentInvoked.Class.Name && $generateMiddleContentInvoked == true )
        <div class="row">
        #if( $currentPage.getStructuredDataNode( "main-group/float-pre-content-blocks-around-wysiwyg-content" ).TextValues.size() > 0 &&
            $currentPage.getStructuredDataNode( "main-group/float-pre-content-blocks-around-wysiwyg-content" ).TextValues[ 0 ] != 'yes' )
            <div class="col-xs-12 clearfix">
        #else
            <div class="col-xs-12">
        #end
        #end
    ##
        #if( $currentPage.getStructuredDataNode( "main-group/float-pre-content-blocks-around-wysiwyg-content" ).TextValues.size() > 0 &&
            $currentPage.getStructuredDataNode( "main-group/float-pre-content-blocks-around-wysiwyg-content" ).TextValues[ 0 ] == 'yes' )
            <div class="rightobject width50">
                #upstateProcessBlockChooser( $currentPage "main-group/mul-post-h1-chooser" )
            </div>
        #end
    #end
##
    #macro( generateWysiwyg )
        #if( !$siteConfigMap[ 'pagesWithoutWysiwyg' ].contains( $currentPagePath ) )
            #if( $currentPage.getStructuredDataNode( "main-group/float-pre-content-blocks-around-wysiwyg-content" ).TextValues.size() > 0 &&
                $currentPage.getStructuredDataNode( "main-group/float-pre-content-blocks-around-wysiwyg-content" ).TextValues[ 0 ] != 'yes' )
                <div>
            #end
            #if( $currentPage.getStructuredDataNode( "main-group/wysiwyg" ).TextValue.Class.Name )
                $currentPage.getStructuredDataNode( "main-group/wysiwyg" ).TextValue.trim()
            #end
            #if( $currentPage.getStructuredDataNode( "main-group/float-pre-content-blocks-around-wysiwyg-content" ).TextValues.size() > 0 &&
                $currentPage.getStructuredDataNode( "main-group/float-pre-content-blocks-around-wysiwyg-content" ).TextValues[ 0 ] != 'yes' )
                </div>
            #end
        #end
        #if( $generatePostH1Invoked.Class.Name && $generatePostH1Invoked == true )
        </div>## col-xs-12
        </div>## row
        #end
    #end
##
    #macro( generatePostWysiwyg )
        #upstateProcessBlockChooser( $currentPage "main-group/mul-post-wysiwyg-chooser" '<div class="row"><div class="col-xs-12">' '</div></div>' )
    #end
#end
##
#*doc
    《/stepcode》
《/step》
《step id=“pageElementGenerateMiddleElement”》
    《title》Generate middleElement《/title》
    《content》
Generate the element wrapping middleContent
    《/content》
    《stepcode》
doc*###
#macro( generateMiddleElement )
    #chanwInvokeMacro( "${design_namespace}GenerateMiddleElement" )
##
    #macro( rwd4GenerateMiddleElement )
    ## main group: center area
    <${siteConfigMap[ 'middleElement' ].trim()} ${middleIdAttribute} class="${middleCssClass}">
    #outputPageElement( "middleContent" )
    </${siteConfigMap[ 'middleElement' ].trim()}>
    #end
#end
##
#*doc
    《/stepcode》
《/step》
《step id=“pageElementGeneratePostMain”》
    《title》Generate preMain《/title》
    《content》
Process all block choosers in post-main-group
    《/content》
    《stepcode》
doc*###
#macro( generatePostMain )
    <div id="post-main-content">
    #upstateProcessBlockChooser( $currentPage "post-main-group/mul-post-main-chooser" )
    </div>
#end
##
#*doc
    《/stepcode》
《/step》
《step id=“pageElementGeneratePreMain”》
    《title》Generate preMain《/title》
    《content》
Process all block choosers in pre-main-group
    《/content》
    《stepcode》
doc*###
#macro( generatePreMain )
    <div id="pre-main-content">
    #upstateProcessBlockChooser( $currentPage "pre-main-group/mul-pre-main-chooser" ) 
    </div>
#end
##
#*doc
    《/stepcode》
《/step》
《step id=“pageElementGenerateScript”》
    《title》Generate script elements《/title》
    《content》
    《/content》
    《stepcode》
doc*###
#macro( generateScript )
    #if( $siteConfigMap[ 'script' ].Class.Name )
        #chanwImportScript( "${BRISK_APP[ 'SITE_DESIGNS_PATH_NTS' ]}/${design_namespace}" $BRISK[ 'APP_SITE_NAME' ] $siteConfigMap[ 'script' ] )
    #else
        #chanwInvokeMacro( "${design_namespace}GenerateScript" )
        ##set( $pageElementMap[ 'scriptContent' ] = "#chanwInvokeMacro(""${design_namespace}GenerateScript"")" )
    #end
##
    #macro( rwd4GenerateScript )
        ## If we are publishing rwd4-js-include
        ## then we only need the base RWD4 assets
        #if( $currentPageSiteName == 'Upstate-Globals' && $currentPage.Name == "rwd4-js-include" )
            <!-- RWD4 Core JS -->
            #drulykgHtmlAssetOutput( {
                'assetPositionEquals' : 0,
                'assetType' : 'js'
            } )
            #drulykgHtmlAssetOutput( {
                'assetPositionEquals' : 0,
                'assetType' : 'jquery_dom_ready'
            } )
            <!--[if lt IE 9]>
            #drulykgHtmlAssetOutput( {
                'assetType' : 'js',
                'assetPositionEquals' : 1
            } )
            #drulykgHtmlAssetOutput( {
                'assetType' : 'jquery_dom_ready',
                'assetPositionEquals' : 1
            } )
            <![endif]-->
            <!-- /RWD4 Core JS -->
        #else
            ## We are publishing a normal web page
            ## Properly differentiate internal Cascade viewing versus external page include
            ##
            $S_SYSTEM_VIEW_INTERNAL
                #drulykgHtmlAssetOutput( {
                    'assetPositionDoesNotEqual' : 1,
                    'assetType' : 'js'
                } )
                #drulykgHtmlAssetOutput( {
                    'assetPositionDoesNotEqual' : 1,
                    'assetType' : 'jquery_dom_ready'
                } )
                <!--[if lt IE 9]>
                #drulykgHtmlAssetOutput( {
                    'assetType' : 'js',
                    'assetPositionEquals' : 1
                } )
                #drulykgHtmlAssetOutput( {
                    'assetType' : 'jquery_dom_ready',
                    'assetPositionEquals' : 1
                } )
                <![endif]-->
            $E_SYSTEM_VIEW_INTERNAL
            $S_SYSTEM_VIEW_EXTERNAL
                $S_PHP_PASSTHROUGH
                    includeGlobalAssets( array( 'design' => 'rwd4' , 'assetType' => 'js' )  );
                $E_PHP_PASSTHROUGH
                <!-- All other JS -->
                #drulykgHtmlAssetOutput( {
                    'assetPositionNotIn' : [ 0 , 1 ],
                    'assetType' : 'js'
                } )
                #drulykgHtmlAssetOutput( {
                    'assetPositionIn' : [ 0 , 1 ],
                    'assetType' : 'jquery_dom_ready'
                } )
                <!-- /All other JS -->
            $E_SYSTEM_VIEW_EXTERNAL
        #end
    #end
#end
##
#*doc
    《/stepcode》
《/step》
《step id=“pageElementGenerateSiteNav”》
    《title》Generate site nav《/title》
    《content》
    《/content》
    《stepcode》
doc*###
#macro( generateSiteNav )
##
    #drulykgHtmlTag( $nulllll {
        'persistentSettings' : {
            'siteRootPageNameOfFolder' : $_EscapeTool.xml( $siteConfigMap[ 'siteRootPageNameOfFolder' ] )
        }
    } )
##
    #drulykgInvokeMacro( "${design_namespace}GenerateSiteNav" )
##
    #macro( rwd4GenerateSiteNav )
##
        <cascadeForcedRoot>
##
        ## Is this a Mega Menu enabled site?
        #if( $_.locateFolder( '_cascade/blocks/mega-menu', $currentPageSiteName ).Class.Name )
            #import( "${BRISK_APP[ 'COMPONENTS_SITEPATH' ]}generateMegaMenu" )
            #generateMegaMenu( $currentPageSiteName )
        #else
            #import( "${BRISK_APP[ 'COMPONENTS_SITEPATH' ]}generateClassicMenu" )
            #generateClassicMenu( $currentPageSiteName )
        #end
##
        ## Always render the mini menu because all sites use it
        #import( "${BRISK_APP[ 'COMPONENTS_SITEPATH' ]}generateMiniMenu" )
        #generateMiniMenu( $currentPageSiteName )
##
        </cascadeForcedRoot>
    #end
#end
##
#*doc
    《/stepcode》
《/step》
《step id=“pageElementGenerateSiteNavForExternalInclude”》
    《title》Generate site nav as a partial page for published pages《/title》
    《content》
    《/content》
    《stepcode》
doc*###
#macro( generateSiteNavForExternalInclude )
    #drulykgInvokeMacro( "${design_namespace}GenerateSiteNavForExternalInclude" )
    #macro( rwd4GenerateSiteNavForExternalInclude )
        #drulykgHtmlTag( $nulllll {
            'persistentSettings' : {
                'convertUrlsToAbsolutePath' : true,
                'protectTagsWithUrlAttrs' : true
            }
        } )
        #outputPageElement( 'siteNav' )
    #end
#end
##
#*doc
    《/stepcode》
《/step》
《step id=“pageElementGenerateSiteNavForInternalNavFeed”》
    《title》Generate site nav as a partial page for Cascade《/title》
    《content》
    《/content》
    《stepcode》
doc*###
#macro( generateSiteNavForInternalNavFeed )
    #drulykgInvokeMacro( "${design_namespace}GenerateSiteNavForInternalNavFeed" )
    #macro( rwd4GenerateSiteNavForInternalNavFeed )
        #drulykgHtmlTag( $nulllll {
            'persistentSettings' : {
                'protectTagsWithUrlAttrs' : true
            }
        } )
        #outputPageElement( 'siteNav' )
    #end
#end
##
#*doc
    《/stepcode》
《/step》
《step id=“pageElementGenerateSiteNavForPageRender”》
    《title》Tie all pieces together for site nav《/title》
    《content》
    《/content》
    《stepcode》
doc*###
#macro( generateSiteNavForPageRender )
##
    #drulykgInvokeMacro( "${design_namespace}GenerateSiteNavForPageRender" )
##
    #macro( rwd4GenerateSiteNavForPageRender )
##
        #set( $rwd4GenerateSiteNavForPageRenderVars = {
            'internal_nav_feed_block': $nulllll,
            'internal_nav_feed_block_xml': $nulllll,
            'internal_nav_feed_block_xml_nav_nodes': $nulllll,
            'siteUrl': $nulllll
        } )
##
        $S_SYSTEM_VIEW_INTERNAL
##
        #set( $INTERNAL_NAV_FOLDER_NAME     = '_extra' )
        #set( $INTERNAL_NAV_FORMAT_NAME     = 'internal-nav' )
        #set( $INTERNAL_NAV_PATH            = $INTERNAL_NAV_FOLDER_NAME + '/' + $INTERNAL_NAV_FORMAT_NAME )
        #set( $INTERNAL_NAV_FEED_BLOCK_NAME = 'internal-nav-feed' )
        #set( $INTERNAL_NAV_FEED_BLOCK_PATH = $INTERNAL_NAV_FOLDER_NAME + '/' + $INTERNAL_NAV_FEED_BLOCK_NAME )
##
        ## Make sure we have an internal nav page
        #if( $_.locatePage( $INTERNAL_NAV_PATH, $currentPageSiteName ).Class.Name )
##
            ## Make sure we have a feed block which is designed to consume the internal nav page from the server
            #set( $rwd4GenerateSiteNavForPageRenderVars[ 'internal_nav_feed_block' ] = $_.locateBlock( $INTERNAL_NAV_FEED_BLOCK_PATH, $currentPageSiteName ) )
            #if( $rwd4GenerateSiteNavForPageRenderVars[ 'internal_nav_feed_block' ].Class.Name )
##
                ## Make sure that the feed block has properly consumed internal nav page from the server
                #set( $rwd4GenerateSiteNavForPageRenderVars[ 'internal_nav_feed_block_xml' ] = $rwd4GenerateSiteNavForPageRenderVars[ 'internal_nav_feed_block' ].FeedAsXMLElement )
                #if( $rwd4GenerateSiteNavForPageRenderVars[ 'internal_nav_feed_block_xml' ].Class.Name )
##
                    ## Make sure that we have at least one <nav> tag
                    #set( $rwd4GenerateSiteNavForPageRenderVars[ 'internal_nav_feed_block_xml_nav_nodes' ] = $_XPathTool.selectNodes( $rwd4GenerateSiteNavForPageRenderVars[ 'internal_nav_feed_block_xml' ], "//nav" ) )
                    #if( $rwd4GenerateSiteNavForPageRenderVars[ 'internal_nav_feed_block_xml_nav_nodes' ].size() > 1 )
                        $_SerializerTool.serialize( $rwd4GenerateSiteNavForPageRenderVars[ 'internal_nav_feed_block_xml_nav_nodes' ][ 0 ], false )
                        #if( $siteConfigMap[ 'turnOffMobileMenu' ] == 'No' )
                            $_SerializerTool.serialize( $rwd4GenerateSiteNavForPageRenderVars[ 'internal_nav_feed_block_xml_nav_nodes' ][ 1 ], false )  
                        #else
                            <div class="hidden-md hidden-lg">Mobile navigation disabled for Cascade page rendering.</div>
                        #end
                    #else
                        ## <nav> tag is missing
                        <div>Error: The nav tag is missing from the published site://${currentPageSiteName}/${INTERNAL_NAV_PATH} page.</div>
                    #end
                #else
                    ## The internal nav feed block could not be consumed as XML
                    <div>Error: site://${currentPageSiteName}/${INTERNAL_NAV_FEED_BLOCK_PATH} is not working correctly. Possible issues include:</div>
                    <ul>
                        <li>The URL is incorrect in the site://${currentPageSiteName}/${INTERNAL_NAV_FEED_BLOCK_PATH} block</li>
                        <li>The site://${currentPageSiteName}/${INTERNAL_NAV_PATH} page needs to be published</li>
                        <li>The HTML of the published site://${currentPageSiteName}/${INTERNAL_NAV_PATH} page is malformed</li>
                    </ul>
                #end
            #else
                ## Internal nav feed block is missing
                <div>Error: site://${currentPageSiteName}/${INTERNAL_NAV_FEED_BLOCK_PATH} block is missing. Please create a site://${currentPageSiteName}/${INTERNAL_NAV_FEED_BLOCK_PATH} block and link it to the published destination of the site://${currentPageSiteName}/${INTERNAL_NAV_PATH} page.</div>
            #end
        #else
            ## Internal nav page is missing from Cascade
            <div>Error: site://${currentPageSiteName}/${INTERNAL_NAV_PATH} page is missing. Please create and publish a site://${currentPageSiteName}/${INTERNAL_NAV_PATH} page.</div>
        #end
        $E_SYSTEM_VIEW_INTERNAL
##
        ## For external viewing (page is being published) we need to use PHP's include
        $S_PHP_PASSTHROUGH
        #set( $rwd4GenerateSiteNavForPageRenderVars[ 'siteUrl' ] = $currentPage.site.Url.trim() )
        #if(
            $rwd4GenerateSiteNavForPageRenderVars[ 'siteUrl' ].toLowerCase().startsWith( 'http' ) ||
            $rwd4GenerateSiteNavForPageRenderVars[ 'siteUrl' ].startsWith( '//' )
        )
            #drulykgConvertToArrayList( $rwd4GenerateSiteNavForPageRenderVars[ 'siteUrl' ].split( '/' ) )
            #set( $rwd4GenerateSiteNavForPageRenderVars[ 'siteUrl' ] = $drulykgConvertToArrayList )
            #if( $rwd4GenerateSiteNavForPageRenderVars[ 'siteUrl' ].size() >= 3 )
                #set( $void = $rwd4GenerateSiteNavForPageRenderVars[ 'siteUrl' ].remove( 2 ) )
                #set( $void = $rwd4GenerateSiteNavForPageRenderVars[ 'siteUrl' ].remove( 1 ) )
                #set( $void = $rwd4GenerateSiteNavForPageRenderVars[ 'siteUrl' ].remove( 0 ) )
            #end
            #set( $rwd4GenerateSiteNavForPageRenderVars[ 'siteUrl' ] = $_DisplayTool.list( $rwd4GenerateSiteNavForPageRenderVars[ 'siteUrl' ], '/' ) )
        #end
        includeFileWithoutRoot( ${_EscapeTool.d}_SERVER[ 'DOCUMENT_ROOT' ] . "/${rwd4GenerateSiteNavForPageRenderVars[ 'siteUrl' ]}/_extra/external-nav${siteConfigMap[ 'sitePagePublicFileExtension' ]}" );
        $E_PHP_PASSTHROUGH
    #end
#end
##
#*doc
    《/stepcode》
《/step》
《step id=“pageElementGenerateTitle”》
    《title》Generate the title element《/title》
    《content》
    《/content》
    《stepcode》
doc*###
#macro( generateTitle )
    #if( $siteConfigMap[ 'siteTitleString' ] != "" )
        #set( $siteTitleString = $siteConfigMap[ 'siteTitleString' ] + " |" )
    #else
        #set( $siteTitleString = "" )
    #end
<title>#if( $currentPage.path == "index" )
    $siteTitleString SUNY Upstate Medical University#else<system-page-title/> | ${siteTitleString}SUNY Upstate Medical University#end</title>
#end
##
#*doc
    《/stepcode》
《/step》
《step id=“pageElementGenerateTopContent”》
    《title》Generate the topContent《/title》
    《content》
The topContent includes all block choosers in the top-group 
to be displayed in the left column/top row
    《/content》
    《stepcode》
doc*###
#macro( generateTopContent )
    #if( $siteConfigMap[ 'renderFolderNav' ] && $siteConfigMap[ 'folderNavOnTopLeft' ] && !$siteConfigMap[ 'skipPageElement' ][ 'folderNav' ].contains( $currentPagePath ) )
        #outputPageElement( "folderNav" )
    #end
    ## process block choosers
    #upstateProcessBlockChooser( $currentPage "top-group/mul-top-group-chooser" )
#end
##
#*doc
    《/stepcode》
《/step》
《step id=“pageElementGenerateTopElement”》
    《title》Generate top element《/title》
    《content》
Generate the element wrapping topContent
    《/content》
    《stepcode》
doc*###
#macro( generateTopElement )
    #getTopMiddleBottomInfo
    #resolvePageTreeName
    #chanwInvokeMacro( "${design_namespace}GenerateTopElement" )
##
    #macro( rwd4GenerateTopElement )
    <${siteConfigMap[ 'topElement' ].trim()} ${topIdAttribute} class="${topCssClass}">
    #outputPageElement( "topContent" )
    </${siteConfigMap[ 'topElement' ].trim()}>
    #end
#end
##
#*doc
    《/stepcode》
《/step》
《step id=“pageElementGetTopMiddleBottomInfo”》
    《title》Resolve variables related to page layout《/title》
    《content》
Resolve variables related to page layout; values are read from 
《code》$siteConfigMap《/code》
    《/content》
    《stepcode》
doc*###
#macro( getTopMiddleBottomInfo )
	## local class for page background
	#set( $containerClass = "container " + $siteConfigMap[ 'pageCssClass' ] )
##
	#if( $siteConfigMap[ 'wrapperId' ].trim() != "" )
		#set( $wrapperIdAttribute = "id=""${siteConfigMap[ 'wrapperId' ].trim()}""" )
	#else
		#set( $wrapperIdAttribute = "" )
	#end
##
	#if( $siteConfigMap[ 'topId' ].trim() != "" )
		#set( $topIdAttribute = "id=""${siteConfigMap[ 'topId' ].trim()}""" )
	#else
		#set( $topIdAttribute = "" )
	#end
##
	#if( $siteConfigMap[ 'middleId' ].trim() != "" )
		#set( $middleIdAttribute = "id=""${siteConfigMap[ 'middleId' ].trim()}""" )
	#else
		#set( $middleIdAttribute = "" )
	#end
##
	#if( $siteConfigMap[ 'bottomId' ].trim() != "" )
		#set( $bottomIdAttribute = "id=""${siteConfigMap[ 'bottomId' ].trim()}""" )
	#else
		#set( $bottomIdAttribute = "" )
	#end
#end
##
#*doc
    《/stepcode》
《/step》
《step id=“pageElementOutputElement”》
    《title》Output markups of an element《/title》
    《content》
Macro which is used to set items in $pageElementMap and then output them. 
The params for this macro are used simply as a passthrough to #setPageElement
    《/content》
    《stepcode》
doc*###
#macro( outputPageElement $elementName_outputPageElement $options_outputPageElement )
##
    ## Is the currently rendered page not supposed to contain this element?
    #if( !$siteConfigMap[ 'skipPageElement' ][ $elementName_outputPageElement ].contains( $currentPagePath ) )
##
        ## Set this element
        #setPageElement( $elementName_outputPageElement $options_outputPageElement )
##
        ## Output this element
        $pageElementMap[ "${elementName_outputPageElement}Content" ]
    #end
#end
##
#*doc
    《/stepcode》
《/step》
《step id=“pageElementSetPageElement”》
    《title》Set items in $pageElementMap《/title》
    《content》
    《/content》
    《stepcode》
doc*###
#macro( setPageElement $elementName_setPageElement $options_setPageElement )
##
    ## Set $pageElementMap if the item is not already set or
    ## if the invoker wants it forced
    #if(
        !$pageElementMap[ "${elementName_setPageElement}Content" ].Class.Name ||
    	$options_setPageElement[ 'forceSet' ] == true
    )
        #if( !$pageElementMap.Class )
            #set( $pageElementMap = {} )
        #end
##
        ## Set the $pageElementMap item to the output of the "generate"
        ## macro which is called.
        ## $options_setPageElement[ 'paramsForGenerate' ] can be used to
        ## pass a list of parameters to the "generate" macro so we use
        ## #drulykgInvokeMacro and blindly pass in $options_setPageElement[ 'paramsForGenerate' ]
        ## because #drulykgInvokeMacro does nothing with nulls/undefined variables.
    	#set( $pageElementMap[ "${elementName_setPageElement}Content" ] = " 
    		#drulykgInvokeMacro(
    			""generate${globalApacheStringUtils.capitalize( $elementName_setPageElement )}""
                $options_setPageElement[ 'paramsForGenerate' ]
    		)
    	")
    #end
#end
##
#*doc
    《/stepcode》
《/step》
《step id=“pageElementProcessBlockChooser”》
    《title》Process block choosers《/title》
    《content》
    《/content》
    《stepcode》
doc*###
#macro( upstateProcessBlockChooser $rootElement_upstateProcessBlockChooser $xPath_upstateProcessBlockChooser $preString_upstateProcessBlockChooser $postString_upstateProcessBlockChooser )
    #if( $rootElement_upstateProcessBlockChooser.Class.Name == $ORG_JDOM_ELEMENT_CLASS_NAME )
        #set( $choosers = "" )
        #set( $choosers = $_XPathTool.selectNodes( $rootElement_upstateProcessBlockChooser, $xPath_upstateProcessBlockChooser ) )
##
        #if( $choosers.size() > 0 )
            #foreach( $chooser in $choosers )
                #set( $chooserContent = "" )
                #set( $chooserContent = $chooser.getChild( "content" ) )
##        
                #if( $chooserContent != "" )
                    #if( $preString_upstateProcessBlockChooser && $preString_upstateProcessBlockChooser != "" )$preString_upstateProcessBlockChooser#end
                    #chanwProcessBlockChooser( $chooserContent )
                    #if( $postString_upstateProcessBlockChooser && $postString_upstateProcessBlockChooser != "" )$postString_upstateProcessBlockChooser#end
                #end
            #end
        #end
    #elseif( $rootElement_upstateProcessBlockChooser.Class.Name == $COM_CASCADE_PAGE_API_CLASS_NAME )
        #set( $choosers = $rootElement_upstateProcessBlockChooser.getStructuredDataNodes( $xPath_upstateProcessBlockChooser ) )
        #if( $choosers.size() > 0 )
            #foreach( $chooser in $choosers )
                #if( $chooser.Asset.Class.Name )
                    #if( $preString_upstateProcessBlockChooser && $preString_upstateProcessBlockChooser != "" )$preString_upstateProcessBlockChooser#end
                    #chanwProcessBlockChooser( $chooser.Asset )
                    #if( $postString_upstateProcessBlockChooser && $postString_upstateProcessBlockChooser != "" )$postString_upstateProcessBlockChooser#end
                #end
            #end
        #end
    #end
#end
##
#*doc
    《/stepcode》
《/step》
《step id=“pageElementResolvePageTreeName”》
    《title》Resolve the name of the tree used for main《/title》
    《content》
    《/content》
    《stepcode》
doc*###
#macro( resolvePageTreeName )
    ## this macro is called after upstateProcessSetupBlock, and $siteConfigMap[ 'treeName' ] is already defined there
    ## $page_tree_name is always defined on the page
    #set( $page_tree_name = $currentPage.Metadata.getDynamicField( "tree-picker" ).Value )
    #if( $page_tree_name != "inherited" )
        #set( $siteConfigMap[ 'treeName' ] = $page_tree_name )
    #end
    #resolveRowColumnCssClass
#end
##
#*doc
    《/stepcode》
《/step》
《step id=“pageElementResolveRowColumnCssClass”》
    《title》Resolve variables related to CSS classes for page layout《/title》
    《content》
    《/content》
    《stepcode》
doc*###
#macro( resolveRowColumnCssClass )
    #if( $siteConfigMap[ 'treeName' ] == "center" )
        #set( $middleCssClass = $siteConfigMap[ 'middleCenterWithNoTopLeftNoBottomRightCssClass' ] )
    #elseif( $siteConfigMap[ 'treeName' ] == "left-center" )
        #set( $topCssClass    = $siteConfigMap[ 'topLeftCssClass' ] )
		#set( $middleCssClass = $siteConfigMap[ 'middleCenterWithNoBottomRightCssClass' ] )
    #elseif( $siteConfigMap[ 'treeName' ] == "center-right" )
        #set( $middleCssClass = $siteConfigMap[ 'middleCenterWithNoTopLeftCssClass' ] )
		#set( $bottomCssClass = $siteConfigMap[ 'bottomRightCssClass' ] )
    #elseif( $siteConfigMap[ 'treeName' ] == "3-column" )
        #set( $topCssClass    = $siteConfigMap[ 'topLeftCssClass' ] )
		#set( $middleCssClass = $siteConfigMap[ 'middleCenterCssClass' ] )
		#set( $bottomCssClass = $siteConfigMap[ 'bottomRightCssClass' ] )
    #end
#end
#*doc
    《/stepcode》
《/step》
《/documentationautoflow》
doc*###